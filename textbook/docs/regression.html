<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>12 Regression | Reproducible statistics for psychologists with R</title>
<meta name="author" content="Matthew J. C. Crump">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.5.3/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.3.9000/tabs.js"></script><script src="libs/bs3compat-0.2.3.9000/bs3compat.js"></script><link href="libs/bs_font_google_work%20sans-0.2.3.9000/font.css" rel="stylesheet">
<link href="libs/bs_font_google_major%20mono%20display-0.2.3.9000/font.css" rel="stylesheet">
<link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/kePrint-0.0.1/kePrint.js"></script><link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet">
<!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=G-TJYWEN5QYP"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-TJYWEN5QYP');
    </script><link rel="icon" href="https://crumplab.github.io/rstatsforpsych/favicon.ico">
<meta property="og:card" content="website">
<meta property="og:title" content="12 Regression | Reproducible statistics for psychologists with R">
<meta property="og:image" content="https://crumplab.github.io/rstatsforpsych/imgs/cover.png">
<meta property="og:url" content="https://crumplab.github.io/rstatsforpsych/">
<meta property="og:description" content="A lab curriculum for psych stats that introduces R and scripting for reproducible analyses.">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@MattCrump_">
<meta name="twitter:title" content="12 Regression | Reproducible statistics for psychologists with R">
<meta name="twitter:description" content="A lab curriculum for psych stats that introduces R and scripting for reproducible analyses.">
<meta name="twitter:image" content="https://crumplab.github.io/rstatsforpsych/imgs/rstats_large.png">
<script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="custom.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="Lab Tutorials">Reproducible statistics for psychologists with R</a>:
        <small class="text-muted">Lab Tutorials</small>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Welcome</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li class="book-part">Getting started</li>
<li><a class="" href="r-rstudio-github.html">R, RStudio, &amp; Github</a></li>
<li><a class="" href="basic-r-programming.html">Basic R programming</a></li>
<li><a class="" href="practice-problems.html">Practice problems</a></li>
<li><a class="" href="coding-reference.html">Coding Reference</a></li>
<li><a class="" href="textbooks-and-other-resources.html">Textbooks and Other Resources</a></li>
<li class="book-part">Labs</li>
<li><a class="" href="r-basics.html"><span class="header-section-number">1</span> R Basics</a></li>
<li><a class="" href="descriptives.html"><span class="header-section-number">2</span> Descriptives</a></li>
<li><a class="" href="distributions-i.html"><span class="header-section-number">3</span> Distributions I</a></li>
<li><a class="" href="distributions-ii.html"><span class="header-section-number">4</span> Distributions II</a></li>
<li><a class="" href="sampling-distributions.html"><span class="header-section-number">5</span> Sampling Distributions</a></li>
<li><a class="" href="statistical-inference.html"><span class="header-section-number">6</span> Statistical Inference</a></li>
<li><a class="" href="binomial-test.html"><span class="header-section-number">7</span> Binomial Test</a></li>
<li><a class="" href="z-tests.html"><span class="header-section-number">8</span> Z tests</a></li>
<li><a class="" href="chi-square.html"><span class="header-section-number">9</span> Chi Square</a></li>
<li><a class="" href="t-tests.html"><span class="header-section-number">10</span> T-tests</a></li>
<li><a class="" href="simulation-and-power-analysis.html">Simulation and Power Analysis</a></li>
<li><a class="" href="correlation.html"><span class="header-section-number">11</span> Correlation</a></li>
<li><a class="active" href="regression.html"><span class="header-section-number">12</span> Regression</a></li>
<li><a class="" href="semester-1-project.html">Semester 1 project</a></li>
<li><a class="" href="references-1.html">References</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/CrumpLab/rstatsforpsych">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="regression" class="section level1" number="12">
<h1>
<span class="header-section-number">12</span> Regression<a class="anchor" aria-label="anchor" href="#regression"><i class="fas fa-link"></i></a>
</h1>
<p>“10/8/2020 | Last Compiled: 2020-12-14”</p>
<div id="readings-2" class="section level2" number="12.1">
<h2>
<span class="header-section-number">12.1</span> Readings<a class="anchor" aria-label="anchor" href="#readings-2"><i class="fas fa-link"></i></a>
</h2>
<p><span class="citation"><a href="references-1.html#ref-vokeyThinkingData7th2018" role="doc-biblioref">Vokey &amp; Allen</a>,<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references-1.html#ref-vokeyThinkingData7th2018" role="doc-biblioref"&gt;2018&lt;/a&gt;.&lt;/p&gt;'><sup>53</sup></a></span> Chapter 8; <span class="citation"><a href="references-1.html#ref-abdiExperimentalDesignAnalysis2009" role="doc-biblioref">Abdi, Edelman, Dowling, &amp; Valentin</a>,<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references-1.html#ref-abdiExperimentalDesignAnalysis2009" role="doc-biblioref"&gt;2009&lt;/a&gt;.&lt;/p&gt;'><sup>54</sup></a></span> Chapters 3 and 4; <span class="citation"><a href="references-1.html#ref-crumpAnsweringQuestionsData2018" role="doc-biblioref">Crump, Navarro, &amp; Suzuki</a>,<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references-1.html#ref-crumpAnsweringQuestionsData2018" role="doc-biblioref"&gt;2018&lt;/a&gt;.&lt;/p&gt;'><sup>55</sup></a></span> <a href="https://crumplab.github.io/statistics/Correlation.html#regression-a-mini-intro">3.5</a>.</p>
</div>
<div id="overview-12" class="section level2" number="12.2">
<h2>
<span class="header-section-number">12.2</span> Overview<a class="anchor" aria-label="anchor" href="#overview-12"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li>Practical: Performing linear regressions with R</li>
<li>Concept I: The best fit line and least squares</li>
<li>Concept II: <span class="math inline">\(R^2\)</span> and <span class="math inline">\(F\)</span>
</li>
<li>Advanced Concept: Best fit line by brute force search</li>
</ol>
</div>
<div id="practical-i-simple-linear-regression-in-r" class="section level2" number="12.3">
<h2>
<span class="header-section-number">12.3</span> Practical I: Simple linear Regression in R<a class="anchor" aria-label="anchor" href="#practical-i-simple-linear-regression-in-r"><i class="fas fa-link"></i></a>
</h2>
<p>Some questions we’ll answer in this section:</p>
<ol style="list-style-type: decimal">
<li>How do I conduct a linear regression in R?</li>
<li>How do I find the best fit line in R?</li>
<li>How do I graph the best fit line with ggplot2?</li>
</ol>
<div id="lm" class="section level3" number="12.3.1">
<h3>
<span class="header-section-number">12.3.1</span> <code>lm()</code><a class="anchor" aria-label="anchor" href="#lm"><i class="fas fa-link"></i></a>
</h3>
<p>Base R comes with the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function, short for <code>linear models</code>, that can perform linear regression among other analyses. We will come back to <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> in later labs.</p>
<div class="sourceCode" id="cb429"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="op">?</span><span class="va">lm</span></code></pre></div>
<p>Here are some basic examples of computing a linear regression with <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>. I step through the pieces after this code chunk.</p>
<div class="sourceCode" id="cb430"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Dataframe with dependent and independent variables</span>
<span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y_dv<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,
                        X_iv<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span>

<span class="co">#compute linear regression,</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y_dv</span> <span class="op">~</span> <span class="va">X_iv</span>, data<span class="op">=</span><span class="va">some_data</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = Y_dv ~ X_iv, data = some_data)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)         X_iv  </span>
<span class="co">#&gt;         1.0          0.5</span>

<span class="co"># saving and output</span>
<span class="va">save_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y_dv</span> <span class="op">~</span> <span class="va">X_iv</span>, data<span class="op">=</span><span class="va">some_data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">save_model</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span>
<span class="co">#&gt; [1] 0.5384615</span>

<span class="co"># r and r^2</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span><span class="op">(</span><span class="va">some_data</span><span class="op">$</span><span class="va">Y_dv</span>,<span class="va">some_data</span><span class="op">$</span><span class="va">X_iv</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Pearson's product-moment correlation</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  some_data$Y_dv and some_data$X_iv</span>
<span class="co">#&gt; t = 2.6458, df = 6, p-value = 0.03825</span>
<span class="co">#&gt; alternative hypothesis: true correlation is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  0.06031428 0.94817953</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt;       cor </span>
<span class="co">#&gt; 0.7337994</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">save_model</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span>
<span class="co">#&gt; [1] 0.5384615</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">save_model</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.7337994</span></code></pre></div>
<div id="use-long-data-format" class="section level4" number="12.3.1.1">
<h4>
<span class="header-section-number">12.3.1.1</span> Use long-data format<a class="anchor" aria-label="anchor" href="#use-long-data-format"><i class="fas fa-link"></i></a>
</h4>
<p><code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> requires data to be long-format (one observation per row), and in a data.frame or similar (e.g., data.table, tibble also work). By convention, I will use Y to refer to the dependent variable, and X to refer to the independent variable.</p>
<div class="sourceCode" id="cb431"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Dataframe with dependent and independent variables</span>
<span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y_dv<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,
                        X_iv<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span></code></pre></div>
</div>
<div id="specify-the-formula" class="section level4" number="12.3.1.2">
<h4>
<span class="header-section-number">12.3.1.2</span> Specify the formula<a class="anchor" aria-label="anchor" href="#specify-the-formula"><i class="fas fa-link"></i></a>
</h4>
<p>The linear regression is performed below. There two basic inputs <code><a href="https://rdrr.io/r/stats/lm.html">lm(formula = , data=)</a></code>. The formula supplied below is <code>Y_dv ~ X_iv</code>. The dependent variable is always placed on the left side (<code>Y_dv</code>), and the independent variable is placed on the right side (<code>X_dv</code>). Order matters. In this case, we are explaining/predicting variation in <code>Y_dv</code> as a function of variation in <code>X_dv</code>.</p>
<div class="sourceCode" id="cb432"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#compute linear regression,</span>
<span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y_dv</span> <span class="op">~</span> <span class="va">X_iv</span>, data<span class="op">=</span><span class="va">some_data</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = Y_dv ~ X_iv, data = some_data)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)         X_iv  </span>
<span class="co">#&gt;         1.0          0.5</span></code></pre></div>
<p>In class we learned that Pearson’s correlation coefficient, <span class="math inline">\(r\)</span>, is related to the coefficient of determination, <span class="math inline">\(R^2\)</span>, which measures the proportion of variance explained. <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> returns <span class="math inline">\(R^2\)</span>, but not <span class="math inline">\(r\)</span>. Below is a quick demonstration that square-rooting <span class="math inline">\(R^2\)</span> from <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code>, gives the same value as <span class="math inline">\(r\)</span> from <code><a href="https://rdrr.io/r/stats/cor.test.html">cor.test()</a></code>.</p>
<div class="sourceCode" id="cb433"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># r and r^2</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.test.html">cor.test</a></span><span class="op">(</span><span class="va">some_data</span><span class="op">$</span><span class="va">Y_dv</span>,<span class="va">some_data</span><span class="op">$</span><span class="va">X_iv</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Pearson's product-moment correlation</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  some_data$Y_dv and some_data$X_iv</span>
<span class="co">#&gt; t = 2.6458, df = 6, p-value = 0.03825</span>
<span class="co">#&gt; alternative hypothesis: true correlation is not equal to 0</span>
<span class="co">#&gt; 95 percent confidence interval:</span>
<span class="co">#&gt;  0.06031428 0.94817953</span>
<span class="co">#&gt; sample estimates:</span>
<span class="co">#&gt;       cor </span>
<span class="co">#&gt; 0.7337994</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">save_model</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span>
<span class="co">#&gt; [1] 0.5384615</span>
<span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">save_model</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.7337994</span></code></pre></div>
<p>The output prints the y-intercept and slope needed to draw the best-fit line from the regression.</p>
</div>
<div id="model-summary" class="section level4" number="12.3.1.3">
<h4>
<span class="header-section-number">12.3.1.3</span> Model summary<a class="anchor" aria-label="anchor" href="#model-summary"><i class="fas fa-link"></i></a>
</h4>
<p>In addition, if the output is assigned to an object, then it can be inspected and manipulated further. For example, additional information can be printed with the summary function.</p>
<div class="sourceCode" id="cb434"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">save_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y_dv</span> <span class="op">~</span> <span class="va">X_iv</span>, data<span class="op">=</span><span class="va">some_data</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">save_model</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = Y_dv ~ X_iv, data = some_data)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;    Min     1Q Median     3Q    Max </span>
<span class="co">#&gt;  -1.50  -0.75   0.25   1.00   1.00 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;             Estimate Std. Error t value Pr(&gt;|t|)  </span>
<span class="co">#&gt; (Intercept)    1.000      1.126   0.888   0.4087  </span>
<span class="co">#&gt; X_iv           0.500      0.189   2.646   0.0382 *</span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 1.225 on 6 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.5385, Adjusted R-squared:  0.4615 </span>
<span class="co">#&gt; F-statistic:     7 on 1 and 6 DF,  p-value: 0.03825</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">save_model</span><span class="op">)</span><span class="op">$</span><span class="va">r.squared</span>
<span class="co">#&gt; [1] 0.5384615</span></code></pre></div>
</div>
</div>
<div id="ggplot2-1" class="section level3" number="12.3.2">
<h3>
<span class="header-section-number">12.3.2</span> ggplot2<a class="anchor" aria-label="anchor" href="#ggplot2-1"><i class="fas fa-link"></i></a>
</h3>
<p>Best fit lines can easily be displayed on scatterplots with ggplot2, here is a basic example. Note that I have only supplied the dataframe with the X and Y variables. <code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> adds the dots, and <code><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth()</a></code> computes the regression and adds the line using the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> method we described above. It is possible to add confidence intervals by setting <code>se=TRUE</code>, but if it’s not clear to you how the intervals are computed, you might not decide to use this default.</p>
<div id="geom_smooth" class="section level4" number="12.3.2.1">
<h4>
<span class="header-section-number">12.3.2.1</span> geom_smooth<a class="anchor" aria-label="anchor" href="#geom_smooth"><i class="fas fa-link"></i></a>
</h4>
<div class="sourceCode" id="cb435"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X_iv</span>, y<span class="op">=</span><span class="va">Y_dv</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">'lm'</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-8-1.png" width="100%"></div>
<p>If you had many sets of X Y data specified in a data frame you can create multiple scatterplots, each with their own best fit line, using <code><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap()</a></code>.</p>
<div class="sourceCode" id="cb436"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">some_data2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="fl">10</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,
                         X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">4</span><span class="op">*</span><span class="fl">10</span>,<span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>,
                        set <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,each<span class="op">=</span><span class="fl">10</span><span class="op">)</span><span class="op">)</span> 

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data2</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>, y<span class="op">=</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">'lm'</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">set</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-9-1.png" width="100%"></div>
</div>
<div id="add-equations-and-model-info" class="section level4" number="12.3.2.2">
<h4>
<span class="header-section-number">12.3.2.2</span> Add equations and model info<a class="anchor" aria-label="anchor" href="#add-equations-and-model-info"><i class="fas fa-link"></i></a>
</h4>
<p><code>ggplot2</code> does not automatically show the regression equation or <span class="math inline">\(R^2\)</span> values, but they can be added with <a href="https://ggplot2-book.org/annotations.html">annotations</a>. Or, you could find an extension package that might do the thing you are looking for. For example, there are numerous extensions to ggplot2, <a href="https://exts.ggplot2.tidyverse.org/gallery/" class="uri">https://exts.ggplot2.tidyverse.org/gallery/</a>. One of them is <a href="https://docs.r4photobiology.info/ggpmisc/">ggpmisc</a>, which can help with adding these details to a plot.</p>
<p><code><a href="https://docs.r4photobiology.info/ggpmisc//reference/stat_poly_eq.html">ggpmisc::stat_poly_eq()</a></code> can add the <span class="math inline">\(R^2\)</span> value to the plot.</p>
<div class="sourceCode" id="cb437"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.r4photobiology.info/ggpmisc/">ggpmisc</a></span><span class="op">)</span>
<span class="va">formula</span> <span class="op">&lt;-</span> <span class="va">y</span> <span class="op">~</span> <span class="va">x</span>
<span class="fu"><a href="https://docs.r4photobiology.info/ggpmisc//reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">X_iv</span>, y <span class="op">=</span> <span class="va">Y_dv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">stat_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">formula</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://docs.r4photobiology.info/ggpmisc//reference/stat_poly_eq.html">stat_poly_eq</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">formula</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-10-1.png" width="100%"></div>
<p>Or, you could print the regression line equation, or both. I’ll refer you to <a href="https://docs.r4photobiology.info/ggpmisc/articles/user-guide.html">examples here for more info on using ggpmisc</a>.</p>
<div class="sourceCode" id="cb438"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://docs.r4photobiology.info/ggpmisc//reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span> <span class="va">X_iv</span>, y <span class="op">=</span> <span class="va">Y_dv</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, formula <span class="op">=</span> <span class="va">formula</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://docs.r4photobiology.info/ggpmisc//reference/stat_poly_eq.html">stat_poly_eq</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>label <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes_eval.html">stat</a></span><span class="op">(</span><span class="va">eq.label</span><span class="op">)</span><span class="op">)</span>, formula <span class="op">=</span> <span class="va">formula</span>,
               parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-11-1.png" width="100%"></div>
</div>
</div>
</div>
<div id="concept-i-the-best-fit-line-and-least-squares" class="section level2" number="12.4">
<h2>
<span class="header-section-number">12.4</span> Concept I: The best fit line and least squares<a class="anchor" aria-label="anchor" href="#concept-i-the-best-fit-line-and-least-squares"><i class="fas fa-link"></i></a>
</h2>
<p>The code chunk below generates a linear regression animation using ggplot2 and <a href="https://gganimate.com/index.html">gganimate</a>.</p>
<div class="sourceCode" id="cb439"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://gganimate.com">gganimate</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>

<span class="va">d</span> <span class="op">&lt;-</span> <span class="va">mtcars</span>
<span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span>
<span class="va">d</span><span class="op">$</span><span class="va">predicted</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span>   <span class="co"># Save the predicted values</span>
<span class="va">d</span><span class="op">$</span><span class="va">residuals</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/residuals.html">residuals</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span> <span class="co"># Save the residual values</span>

<span class="va">coefs</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">mpg</span> <span class="op">~</span> <span class="va">hp</span>, data <span class="op">=</span> <span class="va">mtcars</span><span class="op">)</span><span class="op">)</span>
<span class="va">coefs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>
<span class="va">coefs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>

<span class="va">x</span><span class="op">&lt;-</span><span class="va">d</span><span class="op">$</span><span class="va">hp</span>
<span class="va">move_line</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="op">-</span><span class="fl">6</span>,<span class="fl">6</span>,<span class="fl">.5</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span><span class="op">(</span><span class="fl">6</span>,<span class="op">-</span><span class="fl">6</span>,<span class="op">-</span><span class="fl">.5</span><span class="op">)</span><span class="op">)</span>
<span class="va">total_error</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">move_line</span><span class="op">)</span><span class="op">)</span>
<span class="va">cnt</span><span class="op">&lt;-</span><span class="fl">0</span>
<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="va">move_line</span><span class="op">)</span><span class="op">{</span>
  <span class="va">cnt</span><span class="op">&lt;-</span><span class="va">cnt</span><span class="op">+</span><span class="fl">1</span>
  <span class="va">predicted_y</span> <span class="op">&lt;-</span> <span class="va">coefs</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">*</span><span class="va">x</span> <span class="op">+</span> <span class="va">coefs</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">+</span><span class="va">i</span>
  <span class="va">error_y</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">predicted_y</span><span class="op">-</span><span class="va">d</span><span class="op">$</span><span class="va">mpg</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
  <span class="va">total_error</span><span class="op">[</span><span class="va">cnt</span><span class="op">]</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">error_y</span><span class="op">)</span><span class="op">/</span><span class="fl">32</span><span class="op">)</span>
<span class="op">}</span>

<span class="va">move_line_sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">move_line</span>,each<span class="op">=</span><span class="fl">32</span><span class="op">)</span>
<span class="va">total_error_sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="va">total_error</span>,each<span class="op">=</span><span class="fl">32</span><span class="op">)</span>
<span class="va">sims</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">50</span>,each<span class="op">=</span><span class="fl">32</span><span class="op">)</span>

<span class="va">d</span><span class="op">&lt;-</span><span class="va">d</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html">slice</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/ranking.html">row_number</a></span><span class="op">(</span><span class="op">)</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span>

<span class="va">d</span><span class="op">&lt;-</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">d</span>,<span class="va">sims</span>,<span class="va">move_line_sims</span>,<span class="va">total_error_sims</span><span class="op">)</span>

<span class="va">anim</span><span class="op">&lt;-</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html">geom_abline</a></span><span class="op">(</span>intercept <span class="op">=</span> <span class="fl">30.09886</span><span class="op">+</span><span class="va">move_line_sims</span>, slope <span class="op">=</span> <span class="op">-</span><span class="fl">0.06822828</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>linetype<span class="op">=</span><span class="st">'d'</span><span class="op">)</span>, color<span class="op">=</span> <span class="st">'red'</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/lims.html">lims</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">400</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">10</span>,<span class="fl">40</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">hp</span>, yend <span class="op">=</span> <span class="va">predicted</span><span class="op">+</span><span class="va">move_line_sims</span>, color<span class="op">=</span><span class="st">"red"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">predicted</span><span class="op">+</span><span class="va">move_line_sims</span>, ymax<span class="op">=</span><span class="va">mpg</span>, xmin<span class="op">=</span><span class="va">hp</span>, xmax<span class="op">=</span><span class="va">hp</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">predicted</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">residuals</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="va">move_line_sims</span><span class="op">)</span>, fill <span class="op">=</span> <span class="va">total_error_sims</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_gradient.html">scale_fill_gradient</a></span><span class="op">(</span>low<span class="op">=</span><span class="st">"lightgrey"</span>, high<span class="op">=</span><span class="st">"red"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method <span class="op">=</span> <span class="st">"lm"</span>, se <span class="op">=</span> <span class="cn">FALSE</span>, color <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html">theme</a></span><span class="op">(</span>legend.position<span class="op">=</span><span class="st">"none"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">xlab</a></span><span class="op">(</span><span class="st">"X"</span><span class="op">)</span><span class="op">+</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ylab</a></span><span class="op">(</span><span class="st">"Y"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://gganimate.com/reference/transition_manual.html">transition_manual</a></span><span class="op">(</span>frames<span class="op">=</span><span class="va">sims</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://gganimate.com/reference/enter_exit.html">enter_fade</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://gganimate.com/reference/enter_exit.html">exit_fade</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://gganimate.com/reference/ease_aes.html">ease_aes</a></span><span class="op">(</span><span class="st">'sine-in-out'</span><span class="op">)</span>

<span class="fu"><a href="https://gganimate.com/reference/animate.html">animate</a></span><span class="op">(</span><span class="va">anim</span>,fps<span class="op">=</span><span class="fl">5</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb440"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span><span class="op">(</span><span class="st">"imgs/regression_squares.gif"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="imgs/regression_squares.gif" width="100%"></div>
<p>This animation shows two key concepts we will reinforce. First, the regression line is the “best fit line.” And, the “best fit line” is the one that minimizes the sum of the squared deviations between each point and the line.</p>
<p>The blue line represents the best fit line found by linear regression. The roving black line represents other possible lines. For simplicity, the black line has the same slope, but the intercept changes so it moves up and down. As the black line moves, the little red lines show the error between the black line and each data point. The shaded rectangle for each dot represents the squared error. I shaded the the error squares…as the black line moves away from the true regression line, the error squares get bigger and bigger, and redder and redder. This indicates the fit between the line is getting worse (because the error is getting bigger), as the line moves away from the best line. As the black line moves toward the best fit line, you can see the error squares getting smaller, and I shaded them less red, to visually indicate less overall error. When the black line converges on the blue line, we have found the best fit line, the one that minimizes the sum of the squared deviations.</p>
<div id="illustrating-regression-concepts-with-r" class="section level3" number="12.4.1">
<h3>
<span class="header-section-number">12.4.1</span> Illustrating regression concepts with R<a class="anchor" aria-label="anchor" href="#illustrating-regression-concepts-with-r"><i class="fas fa-link"></i></a>
</h3>
<p>The <a href="https://crumplab.github.io/statistics/Correlation.html#regression-a-mini-intr">animation example</a> is modified from <span class="citation"><a href="references-1.html#ref-crumpAnsweringQuestionsData2018" role="doc-biblioref">Crump, Navarro, &amp; Suzuki</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references-1.html#ref-crumpAnsweringQuestionsData2018" role="doc-biblioref"&gt;2018&lt;/a&gt;.&lt;/p&gt;'><sup>56</sup></a></span> (I added the little rectangles to indicate the squared error).</p>
<p>In this concept section we will use R to create a graph like the above animation. Our goal is to see if we can use R to visually illustrate concepts of linear regression. For example, we can already plot data points as a scatterplot, and we can plot the regression line. It would be nice if we could visualize the error between each data point and the line, and perhaps also see that this error is smallest when we use the best fit line, and not some other line.</p>
</div>
<div id="create-a-scatterplot" class="section level3" number="12.4.2">
<h3>
<span class="header-section-number">12.4.2</span> Create a scatterplot<a class="anchor" aria-label="anchor" href="#create-a-scatterplot"><i class="fas fa-link"></i></a>
</h3>
<p>Here is the sample data we were using before:</p>
<div class="sourceCode" id="cb441"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,
                        X<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>, y<span class="op">=</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-14-1.png" width="100%"></div>
</div>
<div id="compute-regression-equation" class="section level3" number="12.4.3">
<h3>
<span class="header-section-number">12.4.3</span> Compute regression equation<a class="anchor" aria-label="anchor" href="#compute-regression-equation"><i class="fas fa-link"></i></a>
</h3>
<p>We can compute the regression line using <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> to get the y-intercept and slope.</p>
<div class="sourceCode" id="cb442"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span>, data<span class="op">=</span><span class="va">some_data</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = Y ~ X, data = some_data)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt; (Intercept)            X  </span>
<span class="co">#&gt;         1.0          0.5</span></code></pre></div>
<p>The regression line represents the best predictions for values of Y as a function of X.</p>
</div>
<div id="generate-predicted-values" class="section level3" number="12.4.4">
<h3>
<span class="header-section-number">12.4.4</span> Generate predicted values<a class="anchor" aria-label="anchor" href="#generate-predicted-values"><i class="fas fa-link"></i></a>
</h3>
<p>We can use the <code><a href="https://rdrr.io/r/stats/predict.lm.html">predict.lm()</a></code> function to compute each of the predictions for us. Thus, when X is the values 1 to 8, we see the following predictions for Y.</p>
<div class="sourceCode" id="cb443"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/predict.lm.html">predict.lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span>, data<span class="op">=</span><span class="va">some_data</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt;   1   2   3   4   5   6   7   8 </span>
<span class="co">#&gt; 2.5 3.5 3.0 2.0 4.0 4.5 5.0 5.5</span></code></pre></div>
<p>Let’s add the predictions into the graph. We will do this by adding a new column to the data.frame. Using <code><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate()</a></code> we can run the prediction function on the existing columns for X and Y.</p>
<div class="sourceCode" id="cb444"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,
                        X<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.lm.html">predict.lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>, y<span class="op">=</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y_pred</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-17-1.png" width="100%"></div>
</div>
<div id="add-regression-line" class="section level3" number="12.4.5">
<h3>
<span class="header-section-number">12.4.5</span> Add regression line<a class="anchor" aria-label="anchor" href="#add-regression-line"><i class="fas fa-link"></i></a>
</h3>
<p>Lets’s also add the regression line in:</p>
<div class="sourceCode" id="cb445"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>, y<span class="op">=</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">'lm'</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y_pred</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-18-1.png" width="100%"></div>
</div>
<div id="visualize-residual-error" class="section level3" number="12.4.6">
<h3>
<span class="header-section-number">12.4.6</span> Visualize residual error<a class="anchor" aria-label="anchor" href="#visualize-residual-error"><i class="fas fa-link"></i></a>
</h3>
<p>The next step is to visually depict the error between each black dot (a data point), and the blue line. This will involve drawing vertical lines between each black dot, and the red dot representing the prediction of the blue line. We can use <code><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment()</a></code> to draw lines.</p>
<div class="sourceCode" id="cb446"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,
                        X<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.lm.html">predict.lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_error <span class="op">=</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">Y_pred</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>, y<span class="op">=</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">'lm'</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y_pred</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">X</span>, yend <span class="op">=</span> <span class="va">Y</span><span class="op">-</span><span class="va">Y_error</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-19-1.png" width="100%"></div>
<p>The blue line happens to be the best fit line, it is the one that minimizes the sum of the squared deviations. We have drawn the deviations as little lines between each black dot and the line.</p>
</div>
<div id="visualize-error-as-squares" class="section level3" number="12.4.7">
<h3>
<span class="header-section-number">12.4.7</span> Visualize error as squares<a class="anchor" aria-label="anchor" href="#visualize-error-as-squares"><i class="fas fa-link"></i></a>
</h3>
<p>Next, let’s illustrate the deviations as squares, which will better depict the actual quantity that is being summed over. We use <code><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect()</a></code> to draw rectangles.</p>
<div class="sourceCode" id="cb447"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,
                        X<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.lm.html">predict.lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_error <span class="op">=</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">Y_pred</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>, y<span class="op">=</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">'lm'</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y_pred</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">X</span>, yend <span class="op">=</span> <span class="va">Y</span><span class="op">-</span><span class="va">Y_error</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">Y</span>, 
                ymax<span class="op">=</span><span class="va">Y_pred</span>, 
                xmin<span class="op">=</span><span class="va">X</span>,
                xmax<span class="op">=</span><span class="va">X</span><span class="op">+</span><span class="va">Y_error</span><span class="op">)</span>, 
            alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-20-1.png" width="100%"></div>
<p>These should look like squares, but they don’t because the X and Y axes aren’t exactly the same scale, and the figure height and width aren’t exactly square :</p>
<div class="sourceCode" id="cb448"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>, y<span class="op">=</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">'lm'</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y_pred</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">X</span>, yend <span class="op">=</span> <span class="va">Y</span><span class="op">-</span><span class="va">Y_error</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">Y</span>, 
                ymax<span class="op">=</span><span class="va">Y_pred</span>, 
                xmin<span class="op">=</span><span class="va">X</span>,
                xmax<span class="op">=</span><span class="va">X</span><span class="op">+</span><span class="va">Y_error</span><span class="op">)</span>, 
            alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>,
                  ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-21-1.png" width="100%"></div>
</div>
<div id="visualize-error-for-worse-fit-lines" class="section level3" number="12.4.8">
<h3>
<span class="header-section-number">12.4.8</span> Visualize error for “worse” fit lines<a class="anchor" aria-label="anchor" href="#visualize-error-for-worse-fit-lines"><i class="fas fa-link"></i></a>
</h3>
<p>Finally, let’s try one or two more graphs to illustrate that if we drew different lines, they would not be the best fit lines. If we drew a “worse” line, we should see that altogether, the squared error boxes get bigger and bigger. For example, the new red line below does not go through the black dots (the line was shifted up), and the squared errors are much larger than the ones for the blue best fit line.</p>
<div class="sourceCode" id="cb449"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,
                        X<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.lm.html">predict.lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">+</span><span class="fl">2</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_error <span class="op">=</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">Y_pred</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>, y<span class="op">=</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">'lm'</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y_pred</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>,y<span class="op">=</span><span class="va">Y_pred</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">X</span>, yend <span class="op">=</span> <span class="va">Y</span><span class="op">-</span><span class="va">Y_error</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">Y</span>, 
                ymax<span class="op">=</span><span class="va">Y_pred</span>, 
                xmin<span class="op">=</span><span class="va">X</span>,
                xmax<span class="op">=</span><span class="va">X</span><span class="op">+</span><span class="va">Y_error</span><span class="op">)</span>, 
            alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>,
                  ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-22-1.png" width="100%"></div>
<p>Let’s see if we can make a faceted graph, showing the red line moving away from the blue in an upward direction in four steps. This should provide good visual evidence of the error squares growing in size.</p>
<div class="sourceCode" id="cb450"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,
                        X<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.lm.html">predict.lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">some_data</span>,
                   <span class="va">some_data</span>,
                   <span class="va">some_data</span>,
                   <span class="va">some_data</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>step <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,each <span class="op">=</span> <span class="fl">8</span><span class="op">)</span>,
         Y_pred <span class="op">=</span> <span class="va">Y_pred</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">.5</span>,<span class="fl">1</span>,<span class="fl">1.5</span>,<span class="fl">2</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_error <span class="op">=</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">Y_pred</span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>, y<span class="op">=</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">'lm'</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y_pred</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>,y<span class="op">=</span><span class="va">Y_pred</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'red'</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">X</span>, yend <span class="op">=</span> <span class="va">Y</span><span class="op">-</span><span class="va">Y_error</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">Y</span>, 
                ymax<span class="op">=</span><span class="va">Y_pred</span>, 
                xmin<span class="op">=</span><span class="va">X</span>,
                xmax<span class="op">=</span><span class="va">X</span><span class="op">+</span><span class="va">Y_error</span><span class="op">)</span>, 
            alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>,
                  ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">step</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-23-1.png" width="100%"></div>
<div class="sourceCode" id="cb451"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="va">slope</span> <span class="op">=</span> <span class="fl">2</span>
<span class="va">b</span> <span class="op">=</span> <span class="fl">1</span>
<span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,
                        X<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_pred <span class="op">=</span> <span class="va">slope</span><span class="op">*</span><span class="va">X</span><span class="op">+</span><span class="va">b</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>error <span class="op">=</span> <span class="va">Y</span><span class="op">-</span><span class="va">Y_pred</span><span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">some_data</span><span class="op">$</span><span class="va">error</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; [1] 648</span></code></pre></div>
</div>
</div>
<div id="concept-ii-r2-f-and-variance-explained" class="section level2" number="12.5">
<h2>
<span class="header-section-number">12.5</span> Concept II: <span class="math inline">\(R^2\)</span>, F, and variance explained<a class="anchor" aria-label="anchor" href="#concept-ii-r2-f-and-variance-explained"><i class="fas fa-link"></i></a>
</h2>
<p><span class="citation"><a href="references-1.html#ref-wrightCorrelationCausation" role="doc-biblioref">Wright, S.</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references-1.html#ref-wrightCorrelationCausation" role="doc-biblioref"&gt;(n.d.). Correlation and &lt;span&gt;Causation&lt;/span&gt;. &lt;em&gt;Journal of Agricultural Research&lt;/em&gt;, &lt;em&gt;20&lt;/em&gt;, 557–585&lt;/a&gt;.&lt;/p&gt;'><sup>57</sup></a></span> is credited <a href="https://en.wikipedia.org/wiki/Coefficient_of_determination">on wikipedia</a> with coining the term <em>coefficient of determination</em> for <span class="math inline">\(R^2\)</span>. It was interesting to read that paper and think about the term coefficient of determination. Wright discussed how plain old correlations could obviously be caused by multiple causal variables, which is one reason why correlation does not equal causation. He sought methods to break a correlation into component causes or paths, and this seems to inspire the rather loaded inspirational term <em>coefficient of determination</em>. I say this term is inspirational because squaring an <span class="math inline">\(r\)</span>-value and using deterministic language doesn’t magically allow one to identify causal forces from a correlation.</p>
<p>If I was to coin a term with less hubris, I would call <span class="math inline">\(R^2\)</span> a <em>co-efficient of composition</em>. Because, as we will see, <span class="math inline">\(R^2\)</span> is not just about squaring a correlation coefficient…it has another (equivalent) definition based on the concept that variance can be partitioned into different parts. Throughout the course this general idea will turn into something called the General Linear Model. For now, it is the idea that variation in some measurement can be broken down into separate components, such that the original data can be re-expressed or “re-composed” in terms of the sum of its parts.</p>
<p>In linear regression we have variation in a Y variable, and we plot that data against an X variable. Then we draw a best fit line. In the next sections, we will see how the data points in Y are decomposed into different parts. The total variation in Y is expressed as the squared differences between each Y value and the mean of Y. This total variation is partitioned into two parts. One part is “explained” by the regression line, the other part is the leftover bits, called residuals.</p>
<div id="explaining-variance" class="section level3" number="12.5.1">
<h3>
<span class="header-section-number">12.5.1</span> Explaining variance<a class="anchor" aria-label="anchor" href="#explaining-variance"><i class="fas fa-link"></i></a>
</h3>
<p>Imagine you are trying to explain some complicated thing, and you want to keep track of how much of that thing you have explained. You could use a formula like this:</p>
<p><span class="math inline">\(\text{Total stuff to explain} = \text{Explained stuff} + \text{Unexplained stuff}\)</span></p>
<p>This conceptual formula partitions the <em>total stuff needing explanation</em> into two parts, explained and unexplained. If you could assign numbers to this formula, then you could keep track of quantities of explanation. <span class="math inline">\(R^2\)</span> and <span class="math inline">\(F\)</span> values are related statistics that give a ratio quantity relating the amount of explained stuff to unexplained stuff.</p>
</div>
<div id="r2-proportion-of-variance-explained" class="section level3" number="12.5.2">
<h3>
<span class="header-section-number">12.5.2</span> <span class="math inline">\(R^2\)</span> proportion of variance explained<a class="anchor" aria-label="anchor" href="#r2-proportion-of-variance-explained"><i class="fas fa-link"></i></a>
</h3>
<p>Imagine you wanted to know a proportion of explained stuff: a ratio of explained stuff over the total amount to be explained. The proportion would be 0 when you haven’t explained anything, and go to 1 as you explain everything that could be explained.</p>
<p><span class="math inline">\(1 = \frac{\text{Explained} + \text{Unexplained}}{\text{Total stuff to explain}}\)</span></p>
<p><span class="math inline">\(\text{Proportion explained} = \frac{\text{Explained}}{\text{Total}} =(1- \frac{\text{Unexplained}}{\text{Total}})\)</span></p>
<p>This is how <span class="math inline">\(R^2\)</span> is calculated. The quantities are replaced with a sum of squares (<span class="math inline">\(SS\)</span>) representing the total amount of variance to be explained. <span class="math inline">\(SS_{Total}\)</span> is split up into parts that “can be explained” (e.g., by the regression line), and parts that remain “unexplained” (residual error).</p>
<p><span class="math inline">\(R^2 = 1 - \frac{SS_{unexplained}}{SS_{Total}} = \frac{SS_{explained}}{SS_{Total}}\)</span></p>
<p>Note, that <span class="math inline">\(R^2\)</span> must go from 0 to 1, because it is set up as a ratio between a part of a whole (the explained part), and a whole (all of the things needing explaining). The explained part can go anywhere from 0 (explaining nothing) to 100% (explaining everything), so the proportion must go from 0 to 1.</p>
</div>
<div id="f-statistic-explained-over-unexplained" class="section level3" number="12.5.3">
<h3>
<span class="header-section-number">12.5.3</span> F-statistic, explained over unexplained<a class="anchor" aria-label="anchor" href="#f-statistic-explained-over-unexplained"><i class="fas fa-link"></i></a>
</h3>
<p>The F statistic is another way to use the general formula to create a ratio that gets larger as you are able to explain more than you can’t.</p>
<p><span class="math inline">\(F = \frac{Explained}{Unexplained}\)</span></p>
<p>Consider how the F ratio works. It is not bounded by 0 and 1. But, the number 1 is still important, it is a tipping point for your explanation.</p>
<ul>
<li><p>If <span class="math inline">\(explained = unexplained\)</span> then, <span class="math inline">\(F =1\)</span>.</p></li>
<li><p>If <span class="math inline">\(explained &gt; unexplained\)</span> then, <span class="math inline">\(F &gt; 1\)</span>;</p></li>
<li><p>and if <span class="math inline">\(explained &lt; unexplained\)</span> then, <span class="math inline">\(F &lt; 1\)</span>.</p></li>
</ul>
<p>F-statistics use measures of variance, which are sums of squares divided by relevant degrees of freedom.</p>
<p><span class="math inline">\(F = \frac{SS_{Explained}/df1}{SS_{Unexplained}/df2} = \frac{MS_{Explained}}{MS_{Unexplained}}\)</span></p>
</div>
<div id="transforming-r2-to-f" class="section level3" number="12.5.4">
<h3>
<span class="header-section-number">12.5.4</span> Transforming <span class="math inline">\(R^2\)</span> to <span class="math inline">\(F\)</span><a class="anchor" aria-label="anchor" href="#transforming-r2-to-f"><i class="fas fa-link"></i></a>
</h3>
<p><span class="citation"><a href="references-1.html#ref-abdiExperimentalDesignAnalysis2009" role="doc-biblioref">Abdi, Edelman, Dowling, &amp; Valentin</a><a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;&lt;a href="references-1.html#ref-abdiExperimentalDesignAnalysis2009" role="doc-biblioref"&gt;2009&lt;/a&gt;.&lt;/p&gt;'><sup>58</sup></a></span> provide a formula (chapter 3) that shows Fs can be converted from <span class="math inline">\(R^2\)</span>.</p>
<p><span class="math inline">\(F = \frac{R^2}{1-R^2} \times (S-2)\)</span></p>
<p>The numerator is <span class="math inline">\(R^2\)</span>, which we have previously defined as the proportion of variance <strong>explained</strong>; and the denominator is the proporition of variance <strong>unexplained</strong>. So, this formula again presents F as a ratio of explained over unexplained variance.</p>
</div>
<div id="visualizing-the-sums-of-squares" class="section level3" number="12.5.5">
<h3>
<span class="header-section-number">12.5.5</span> Visualizing the sums of squares<a class="anchor" aria-label="anchor" href="#visualizing-the-sums-of-squares"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s try to fill in the blanks so that we can see <span class="math inline">\(R^2\)</span> in this way:</p>
<p><span class="math inline">\(R^2 = (1- \frac{\text{Unexplained}}{\text{Total}}) = \frac{\text{Explained}}{\text{Total}}\)</span></p>
<p>We begin with a Y variable and X variable. We are going to use the variability in X as an “explanation” of the variability in Y.</p>
<div class="sourceCode" id="cb452"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span></code></pre></div>
<p>How does this data relate to the formula and to the task of explanation? What are we trying to explain? In this case, the Y variable is taking the place of the dependent measure. The Y variable has numbers that are different, it has variation. So in general language, we are trying to “explain” the variation in Y.</p>
</div>
<div id="ss-total" class="section level3" number="12.5.6">
<h3>
<span class="header-section-number">12.5.6</span> SS total<a class="anchor" aria-label="anchor" href="#ss-total"><i class="fas fa-link"></i></a>
</h3>
<p>In order to put a number into the denominator of our general formula, we need to quantify the total amount of variation in Y. There are two ways we have done that previously, using sums of squares, or the variance (which divides the sums of squares). <span class="math inline">\(SS_{total}\)</span> uses the mean of Y as a starting point, and sums up all of the squared deviations from the mean. So:</p>
<p><span class="math inline">\(SS_{total} = \sum{(Y_i - \bar{Y})^2}\)</span></p>
<div class="sourceCode" id="cb453"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SS_total</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">Y</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="va">SS_total</span>
<span class="co">#&gt; [1] 19.5</span></code></pre></div>
<p>The scatterplot below visualizes <span class="math inline">\(SS_total\)</span>; but, instead of a regression line as we saw earlier, the red line represents the mean of Y. So, the deviations between each dot and the red line represent the components that are added up to produce <span class="math inline">\(SS_total\)</span> for Y. Specifically, the sum of the area in all the error squares is taken as the total amount of stuff that needs to be explained. Slightly more formally, the squared deviations represent departures from the mean of Y. If all of the data in Y had the same number, there would be no departures from the mean, and the mean would “explain everything,” leaving nothing left for any other variable to explain.</p>
<div class="sourceCode" id="cb454"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,
                        X<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_error <span class="op">=</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">Y_pred</span><span class="op">)</span>

<span class="op">(</span><span class="va">total_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>, y<span class="op">=</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y_pred</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'black'</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">X</span>, yend <span class="op">=</span> <span class="va">Y</span><span class="op">-</span><span class="va">Y_error</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">Y</span>, 
                ymax<span class="op">=</span><span class="va">Y_pred</span>, 
                xmin<span class="op">=</span><span class="va">X</span>,
                xmax<span class="op">=</span><span class="va">X</span><span class="op">+</span><span class="va">Y_error</span><span class="op">)</span>, 
            alpha <span class="op">=</span> <span class="fl">.2</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>,
                  ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SS Total"</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-27-1.png" width="100%"></div>
<p>Before moving on, let’s tie the word “explanation” to the idea of prediction. If we were trying to make guesses about the numbers in Y we could use the mean of Y as a best guess or prediction. According to a least squares criterion, the mean is in the center of the data, and it is the value produces the smallest sum of squared deviations. If you guessed the mean for Y every time you sampled a number for Y, you’d be off by some amount each time, and squaring and summing these little errors would give you a total that you could say represents all of variation not accounted for by the mean.</p>
<p>In linear regression we ask whether we can improve our prediction beyond using mean of Y. For example, if we had another variable like X, could we make use of that variable to improve predictions about Y? In other words, is there a way we can line up Y values and X values in such a way that <strong>reduces</strong> the sum of squared errors. If this could be achieved, then knowing something about the mean of Y <strong>and</strong> knowing something about X should reduce prediction error.</p>
</div>
<div id="ss-unexplained-residuals" class="section level3" number="12.5.7">
<h3>
<span class="header-section-number">12.5.7</span> SS unexplained (residuals)<a class="anchor" aria-label="anchor" href="#ss-unexplained-residuals"><i class="fas fa-link"></i></a>
</h3>
<p>Consider now the regression line, and the squared deviations that we produced in the first concept section. I colored the error squares red to flag the fact that the blue regression line does not explain these deviations from the blue line.</p>
<div class="sourceCode" id="cb455"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,
                        X<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.lm.html">predict.lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_error <span class="op">=</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">Y_pred</span><span class="op">)</span>

<span class="op">(</span><span class="va">res_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>, y<span class="op">=</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">'lm'</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">X</span>, yend <span class="op">=</span> <span class="va">Y</span><span class="op">-</span><span class="va">Y_error</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">.5</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">Y</span>, 
                ymax<span class="op">=</span><span class="va">Y_pred</span>, 
                xmin<span class="op">=</span><span class="va">X</span>,
                xmax<span class="op">=</span><span class="va">X</span><span class="op">+</span><span class="va">Y_error</span><span class="op">)</span>, 
            alpha <span class="op">=</span> <span class="fl">.5</span>,
            fill <span class="op">=</span> <span class="st">"red"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>,
                  ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SS Unexplained (residual)"</span><span class="op">)</span>
  <span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-28-1.png" width="100%"></div>
<p>These squared errors represent deviations from the data points to the best fit regression line between derived from X. The sum of these squares also represents a quantity of errors that are not explained (often termed residuals). In other words, we are looking at the “unexplained” part of our general formula.</p>
<p><span class="math inline">\(R^2 = (1- \frac{\text{Unexplained}}{\text{Total}}) = \frac{\text{Explained}}{\text{Total}}\)</span></p>
<p>More specifically, we are looking at another sum of squares, we could call <span class="math inline">\(SS_\text{residuals}\)</span>.</p>
<p><span class="math inline">\(SS_\text{residuals} = \sum{(Y_i - Y'_i)^2}\)</span></p>
<p>Where, <span class="math inline">\(Y'_i\)</span> refers to predicted Y values that we get from the regression equation.</p>
<div class="sourceCode" id="cb456"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Y_predicted</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.lm.html">predict.lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>
<span class="va">Y_predicted</span>
<span class="co">#&gt;   1   2   3   4   5   6   7   8 </span>
<span class="co">#&gt; 2.5 3.5 3.0 2.0 4.0 4.5 5.0 5.5</span>

<span class="va">SS_residuals</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="va">Y</span><span class="op">-</span><span class="va">Y_predicted</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="va">SS_residuals</span>
<span class="co">#&gt; [1] 9</span>

<span class="fl">1</span><span class="op">-</span> <span class="op">(</span><span class="op">(</span><span class="va">SS_residuals</span><span class="op">/</span><span class="op">(</span><span class="fl">8</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">SS_total</span><span class="op">/</span><span class="op">(</span><span class="fl">7</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.4615385</span>


<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">Y</span>,<span class="va">X</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
<span class="co">#&gt; [1] 0.5384615</span></code></pre></div>
<p>We can do a quick check to show that we can compute <span class="math inline">\(R^2\)</span> from</p>
<p><span class="math inline">\(R^2 = (1- \frac{\text{Unexplained}}{\text{Total}}) = \frac{\text{Explained}}{\text{Total}}\)</span></p>
<p><span class="math inline">\(R^2 = (1- \frac{\text{SS_residual}}{\text{SS_total}})\)</span></p>
<div class="sourceCode" id="cb457"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#quick check</span>
<span class="fl">1</span><span class="op">-</span><span class="op">(</span><span class="fl">9</span><span class="op">/</span><span class="fl">19.5</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.5384615</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">Y</span>,<span class="va">X</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
<span class="co">#&gt; [1] 0.5384615</span></code></pre></div>
</div>
<div id="ss-explained-regression" class="section level3" number="12.5.8">
<h3>
<span class="header-section-number">12.5.8</span> SS explained (regression)<a class="anchor" aria-label="anchor" href="#ss-explained-regression"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s finally look at the idea of explained variance. Previously we found <span class="math inline">\(SS_{total}\)</span> and <span class="math inline">\(SS_{residual}\)</span>, but we haven’t directly computed <span class="math inline">\(SS_{explained}\)</span>:</p>
<p><span class="math inline">\(R^2 = (1- \frac{\text{Unexplained}}{\text{Total}}) = \frac{\text{Explained}}{\text{Total}}\)</span></p>
<p><span class="math inline">\(R^2 = (1- \frac{\text{SS}_{residuals}}{\text{SS}_{Total}}) = \frac{\text{SS}_{Explained}}{\text{SS}_{Total}}\)</span></p>
<p>We could use algebra to find <span class="math inline">\(SS_{Explained}\)</span>:</p>
<p><span class="math inline">\(SS_{Total} = \text{SS}_{Explained} + \text{SS}_{residuals}\)</span></p>
<p><span class="math inline">\(\text{SS}_{Explained} = SS_{Total} -\text{SS}_{residuals}\)</span></p>
<p><span class="math inline">\(\text{SS}_{Explained} = 19.5 - 9 = 10.5\)</span></p>
<p>I think it would be more interesting to show the sum of squares for <span class="math inline">\(\text{SS}_{Explained}\)</span> as squares on the scatterplots we have been making. The “explained” variance is associated the squared areas between the black line for the mean of Y, and blue regression line. I colored these squared areas blue.</p>
<div class="sourceCode" id="cb458"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,
                        X<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_pred <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.lm.html">predict.lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span><span class="op">)</span><span class="op">)</span>,
         Y_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_error <span class="op">=</span> <span class="va">Y</span> <span class="op">-</span> <span class="va">Y_pred</span>,
         Y_total <span class="op">=</span> <span class="va">Y</span><span class="op">-</span><span class="va">Y_mean</span><span class="op">)</span>

<span class="op">(</span><span class="va">exp_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">some_data</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">X</span>, y<span class="op">=</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>y<span class="op">=</span><span class="va">Y_mean</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'black'</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>method<span class="op">=</span><span class="st">'lm'</span>, se<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html">geom_segment</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>xend <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y_mean</span>, yend <span class="op">=</span> <span class="va">Y_pred</span><span class="op">)</span>, color<span class="op">=</span><span class="st">'black'</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html">geom_rect</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>ymin<span class="op">=</span><span class="va">Y_mean</span>, 
                ymax<span class="op">=</span><span class="va">Y_pred</span>, 
               xmin<span class="op">=</span><span class="va">X</span>,
                xmax<span class="op">=</span><span class="va">X</span><span class="op">+</span><span class="op">(</span><span class="va">Y_pred</span> <span class="op">-</span> <span class="va">Y_mean</span><span class="op">)</span><span class="op">)</span>, 
            alpha <span class="op">=</span> <span class="fl">.5</span>,
            fill <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_cartesian.html">coord_cartesian</a></span><span class="op">(</span>xlim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span>,
                  ylim<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">10</span><span class="op">)</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_classic</a></span><span class="op">(</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="st">"SS Explained (by Regression of X)"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-31-1.png" width="100%"></div>
<p>The sum of these squares refers to variance in Y that is “explained” by the combination of using the mean of Y as a predictor, and the regression line from X as a predictor.</p>
<p>Previously, we said that <span class="math inline">\(R^2\)</span> is the proportion of variance explained. Or:</p>
<p><span class="math inline">\(R^2 = \frac{SS_{Explained}}{SS_{Total}}\)</span></p>
<p>The sum of the blue squares is equivalent to <span class="math inline">\(SS_{explained}\)</span>. We could also write:</p>
<p><span class="math inline">\(SS_{Explained} = \sum (Y'_i - \bar{Y})^2\)</span></p>
<p>which means the sum of the squared differences between the predicted Y values based on the regression line and the mean of Y (e..g, the sum of the area of blue squares).</p>
<div class="sourceCode" id="cb459"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SS_explained</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/predict.lm.html">predict.lm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">Y</span><span class="op">~</span><span class="va">X</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Y</span><span class="op">)</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>
<span class="va">SS_explained</span>
<span class="co">#&gt; [1] 10.5</span>

<span class="co">#from before</span>
<span class="va">SS_total</span>
<span class="co">#&gt; [1] 19.5</span>

<span class="co">#calculate R^2 as a proportion of total SS</span>
<span class="va">SS_explained</span><span class="op">/</span><span class="va">SS_total</span>
<span class="co">#&gt; [1] 0.5384615</span>

<span class="op">(</span><span class="va">SS_explained</span><span class="op">/</span><span class="fl">8</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">SS_total</span><span class="op">/</span><span class="fl">8</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.5384615</span>

<span class="co"># compare to r^2</span>
<span class="fu"><a href="https://rdrr.io/r/stats/cor.html">cor</a></span><span class="op">(</span><span class="va">Y</span>,<span class="va">X</span><span class="op">)</span><span class="op">^</span><span class="fl">2</span>
<span class="co">#&gt; [1] 0.5384615</span></code></pre></div>
</div>
<div id="all-together" class="section level3" number="12.5.9">
<h3>
<span class="header-section-number">12.5.9</span> All together<a class="anchor" aria-label="anchor" href="#all-together"><i class="fas fa-link"></i></a>
</h3>
<p>We have just created three different scatterplots illustrating that <span class="math inline">\(SS_{total} = SS_{explained} + SS_{unexplained}\)</span>. For ease of looking, I’d like to see them all in one place. We could accomplish this goal in multiple ways, but I’d like to do it by introducing a handy ggplot library called <a href="https://patchwork.data-imaginist.com/index.html">patchwork</a> that makes it easy to combine multiple plots together.</p>
<div class="sourceCode" id="cb460"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com">patchwork</a></span><span class="op">)</span>

<span class="op">(</span><span class="va">total_plot</span> <span class="op">+</span><span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_spacer.html">plot_spacer</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span><span class="op">/</span><span class="op">(</span><span class="va">exp_plot</span><span class="op">+</span><span class="va">res_plot</span><span class="op">)</span><span class="op">+</span>
  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_annotation.html">plot_annotation</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'SStotal = SSexplained + SSunexplained'</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="Lab12_Regression_files/figure-html/unnamed-chunk-33-1.png" width="100%"></div>
</div>
</div>
<div id="advanced-concept-best-fit-line-by-brute-force-search" class="section level2" number="12.6">
<h2>
<span class="header-section-number">12.6</span> Advanced Concept: Best fit line by brute force search<a class="anchor" aria-label="anchor" href="#advanced-concept-best-fit-line-by-brute-force-search"><i class="fas fa-link"></i></a>
</h2>
<p>What if you didn’t know the formulas to compute the slope and y-intercept for the best fit line? If you knew the definition of the best fit line, that it is the line the minimizes the sum of squared deviations between each point and the line (<span class="math inline">\(SS_{residual}\)</span>), then you could potentially find the best line through trial and error.</p>
<p>For example, you could pick any slope and y-intercept and calculate <span class="math inline">\(SS_{residual}\)</span>, then change the slope of the intercept up or down, and see if <span class="math inline">\(SS_{residual}\)</span> get’s smaller…you could keep doing this over and over until you can’t make <span class="math inline">\(SS_{residual}\)</span> any smaller. At the end you would have found the correct parameters for the best fit line.</p>
<p>Below is a quick example of forcing R to try and find correct values for the slope and intercept through trial and error. Sometimes it converges on the right answer in 1000 attempts, and sometimes it doesn’t. The basic idea is:</p>
<ol style="list-style-type: decimal">
<li>choose any starting slope and intercept (b)</li>
<li>compute <span class="math inline">\(SS_{residual}\)</span> between all points and line</li>
<li>randomly change slope and intercept up or down by a small value (.01)</li>
<li>compute <span class="math inline">\(SS_{residual}\)</span> again.</li>
<li>If <span class="math inline">\(SS_{residual}\)</span> is smaller than before, then save the new slope and intercept, and keep repeating</li>
<li>If <span class="math inline">\(SS_{residual}\)</span> is larger than before, then forget the new slope and intercept, and keep randomly changing them until they produce smaller <span class="math inline">\(SS_{residual}\)</span>.</li>
<li>Do this for a long time…the algorithm only allows changes to slope and intercept that make <span class="math inline">\(SS_{residual}\)</span> smaller, so over time, this value should converge on its minimum possible value…which is the one you get for the best fit line.</li>
</ol>
<div class="sourceCode" id="cb461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">step_size</span> <span class="op">&lt;-</span> <span class="fl">.01</span>

<span class="va">slope</span> <span class="op">=</span> <span class="fl">2</span>
<span class="va">b</span> <span class="op">=</span> <span class="fl">1</span>
<span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,
                        X<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_pred <span class="op">=</span> <span class="va">slope</span><span class="op">*</span><span class="va">X</span><span class="op">+</span><span class="va">b</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>error <span class="op">=</span> <span class="va">Y</span><span class="op">-</span><span class="va">Y_pred</span><span class="op">)</span>

<span class="va">sum_deviations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">some_data</span><span class="op">$</span><span class="va">error</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>

<span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fl">1000</span><span class="op">)</span><span class="op">{</span>
  
  <span class="va">new_slope</span> <span class="op">&lt;-</span> <span class="va">slope</span> <span class="op">+</span> <span class="va">step_size</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>
  <span class="va">new_b</span> <span class="op">&lt;-</span> <span class="va">b</span> <span class="op">+</span> <span class="va">step_size</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">1</span>,<span class="fl">1</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span>
  
  <span class="va">some_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">6</span>,<span class="fl">5</span><span class="op">)</span>,
                        X<span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">2</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>Y_pred <span class="op">=</span> <span class="va">new_slope</span><span class="op">*</span><span class="va">X</span><span class="op">+</span><span class="va">new_b</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html">mutate</a></span><span class="op">(</span>error <span class="op">=</span> <span class="va">Y</span><span class="op">-</span><span class="va">Y_pred</span><span class="op">)</span>

<span class="va">new_sum_deviations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">some_data</span><span class="op">$</span><span class="va">error</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>

<span class="kw">if</span><span class="op">(</span><span class="va">new_sum_deviations</span> <span class="op">&lt;</span> <span class="va">sum_deviations</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">sum_deviations</span> <span class="op">&lt;-</span> <span class="va">new_sum_deviations</span>
  <span class="va">slope</span> <span class="op">&lt;-</span> <span class="va">new_slope</span>
  <span class="va">b</span> <span class="op">&lt;-</span> <span class="va">new_b</span>
<span class="op">}</span>
  
<span class="op">}</span>

<span class="va">slope</span>
<span class="co">#&gt; [1] 0.47</span>
<span class="va">b</span>
<span class="co">#&gt; [1] 1.21</span></code></pre></div>
</div>
<div id="lab-12-generalization-assignment" class="section level2" number="12.7">
<h2>
<span class="header-section-number">12.7</span> Lab 12 Generalization Assignment<a class="anchor" aria-label="anchor" href="#lab-12-generalization-assignment"><i class="fas fa-link"></i></a>
</h2>
<div id="instructions-11" class="section level3" number="12.7.1">
<h3>
<span class="header-section-number">12.7.1</span> Instructions<a class="anchor" aria-label="anchor" href="#instructions-11"><i class="fas fa-link"></i></a>
</h3>
<p>In general, labs will present a discussion of problems and issues with example code like above, and then students will be tasked with completing generalization assignments, showing that they can work with the concepts and tools independently.</p>
<p>Your assignment instructions are the following:</p>
<ol style="list-style-type: decimal">
<li>Work inside the R project “StatsLab1” you have been using</li>
<li>Create a new R Markdown document called “Lab12.Rmd”</li>
<li>Use Lab12.Rmd to show your work attempting to solve the following generalization problems. Commit your work regularly so that it appears on your Github repository.</li>
<li>
<strong>For each problem, make a note about how much of the problem you believe you can solve independently without help</strong>. For example, if you needed to watch the help video and are unable to solve the problem on your own without copying the answers, then your note would be 0. If you are confident you can complete the problem from scratch completely on your own, your note would be 100. It is OK to have all 0s or 100s anything in between.</li>
<li>Submit your github repository link for Lab 12 on blackboard.</li>
</ol>
</div>
<div id="problems-11" class="section level3" number="12.7.2">
<h3>
<span class="header-section-number">12.7.2</span> Problems<a class="anchor" aria-label="anchor" href="#problems-11"><i class="fas fa-link"></i></a>
</h3>
<ol style="list-style-type: decimal">
<li>Should you do a linear regression on this data? Explain.</li>
</ol>
<div class="sourceCode" id="cb462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">10</span>,<span class="fl">9</span>,<span class="fl">8</span>,<span class="fl">7</span>,<span class="fl">6</span>,<span class="fl">5</span>,<span class="fl">4</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span><span class="op">)</span>
<span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">3</span>,<span class="fl">4</span>,<span class="fl">5</span>,<span class="fl">6</span>,<span class="fl">7</span>,<span class="fl">8</span>,<span class="fl">9</span>,<span class="fl">10</span>,<span class="fl">11</span>,<span class="fl">12</span>,<span class="fl">13</span>,<span class="fl">14</span>,<span class="fl">15</span>,<span class="fl">16</span>,<span class="fl">17</span>,<span class="fl">18</span>,<span class="fl">19</span><span class="op">)</span></code></pre></div>
</div>
</div>
<div id="references" class="section level2" number="12.8">
<h2>
<span class="header-section-number">12.8</span> References<a class="anchor" aria-label="anchor" href="#references"><i class="fas fa-link"></i></a>
</h2>

</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="correlation.html"><span class="header-section-number">11</span> Correlation</a></div>
<div class="next"><a href="semester-1-project.html">Semester 1 project</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#regression"><span class="header-section-number">12</span> Regression</a></li>
<li><a class="nav-link" href="#readings-2"><span class="header-section-number">12.1</span> Readings</a></li>
<li><a class="nav-link" href="#overview-12"><span class="header-section-number">12.2</span> Overview</a></li>
<li>
<a class="nav-link" href="#practical-i-simple-linear-regression-in-r"><span class="header-section-number">12.3</span> Practical I: Simple linear Regression in R</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#lm"><span class="header-section-number">12.3.1</span> lm()</a></li>
<li><a class="nav-link" href="#ggplot2-1"><span class="header-section-number">12.3.2</span> ggplot2</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#concept-i-the-best-fit-line-and-least-squares"><span class="header-section-number">12.4</span> Concept I: The best fit line and least squares</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#illustrating-regression-concepts-with-r"><span class="header-section-number">12.4.1</span> Illustrating regression concepts with R</a></li>
<li><a class="nav-link" href="#create-a-scatterplot"><span class="header-section-number">12.4.2</span> Create a scatterplot</a></li>
<li><a class="nav-link" href="#compute-regression-equation"><span class="header-section-number">12.4.3</span> Compute regression equation</a></li>
<li><a class="nav-link" href="#generate-predicted-values"><span class="header-section-number">12.4.4</span> Generate predicted values</a></li>
<li><a class="nav-link" href="#add-regression-line"><span class="header-section-number">12.4.5</span> Add regression line</a></li>
<li><a class="nav-link" href="#visualize-residual-error"><span class="header-section-number">12.4.6</span> Visualize residual error</a></li>
<li><a class="nav-link" href="#visualize-error-as-squares"><span class="header-section-number">12.4.7</span> Visualize error as squares</a></li>
<li><a class="nav-link" href="#visualize-error-for-worse-fit-lines"><span class="header-section-number">12.4.8</span> Visualize error for “worse” fit lines</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#concept-ii-r2-f-and-variance-explained"><span class="header-section-number">12.5</span> Concept II: \(R^2\), F, and variance explained</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#explaining-variance"><span class="header-section-number">12.5.1</span> Explaining variance</a></li>
<li><a class="nav-link" href="#r2-proportion-of-variance-explained"><span class="header-section-number">12.5.2</span> \(R^2\) proportion of variance explained</a></li>
<li><a class="nav-link" href="#f-statistic-explained-over-unexplained"><span class="header-section-number">12.5.3</span> F-statistic, explained over unexplained</a></li>
<li><a class="nav-link" href="#transforming-r2-to-f"><span class="header-section-number">12.5.4</span> Transforming \(R^2\) to \(F\)</a></li>
<li><a class="nav-link" href="#visualizing-the-sums-of-squares"><span class="header-section-number">12.5.5</span> Visualizing the sums of squares</a></li>
<li><a class="nav-link" href="#ss-total"><span class="header-section-number">12.5.6</span> SS total</a></li>
<li><a class="nav-link" href="#ss-unexplained-residuals"><span class="header-section-number">12.5.7</span> SS unexplained (residuals)</a></li>
<li><a class="nav-link" href="#ss-explained-regression"><span class="header-section-number">12.5.8</span> SS explained (regression)</a></li>
<li><a class="nav-link" href="#all-together"><span class="header-section-number">12.5.9</span> All together</a></li>
</ul>
</li>
<li><a class="nav-link" href="#advanced-concept-best-fit-line-by-brute-force-search"><span class="header-section-number">12.6</span> Advanced Concept: Best fit line by brute force search</a></li>
<li>
<a class="nav-link" href="#lab-12-generalization-assignment"><span class="header-section-number">12.7</span> Lab 12 Generalization Assignment</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#instructions-11"><span class="header-section-number">12.7.1</span> Instructions</a></li>
<li><a class="nav-link" href="#problems-11"><span class="header-section-number">12.7.2</span> Problems</a></li>
</ul>
</li>
<li><a class="nav-link" href="#references"><span class="header-section-number">12.8</span> References</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/CrumpLab/rstatsforpsych/blob/master/Lab12_Regression.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/CrumpLab/rstatsforpsych/edit/master/Lab12_Regression.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Reproducible statistics for psychologists with R</strong>: Lab Tutorials" was written by Matthew J. C. Crump. </p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
